{"ast":null,"code":"import { runMultipleHook, runSingleHook } from '../components/hooks.js';\nimport { trackRemoval } from '../components/sync-blocking-checker.js';\nexport async function remove(orama, id, language, skipHooks) {\n  let result = true;\n  const {\n    index,\n    docs\n  } = orama.data;\n  const doc = await orama.documentsStore.get(docs, id);\n  if (!doc) {\n    return false;\n  }\n  const docsCount = await orama.documentsStore.count(docs);\n  if (!skipHooks) {\n    await runSingleHook(orama.beforeRemove, orama, id);\n  }\n  const indexableProperties = await orama.index.getSearchableProperties(index);\n  const indexablePropertiesWithTypes = await orama.index.getSearchablePropertiesWithTypes(index);\n  const values = await orama.getDocumentProperties(doc, indexableProperties);\n  for (const prop of indexableProperties) {\n    var _orama_index, _orama_index_beforeRemove, _orama_index1, _orama_index_afterRemove;\n    const value = values[prop];\n    // The document doens't contain the key\n    if (typeof value === 'undefined') {\n      continue;\n    }\n    const schemaType = indexablePropertiesWithTypes[prop];\n    await ((_orama_index_beforeRemove = (_orama_index = orama.index).beforeRemove) === null || _orama_index_beforeRemove === void 0 ? void 0 : _orama_index_beforeRemove.call(_orama_index, orama.data.index, prop, id, value, schemaType, language, orama.tokenizer, docsCount));\n    if (!(await orama.index.remove(orama.index, orama.data.index, prop, id, value, schemaType, language, orama.tokenizer, docsCount))) {\n      result = false;\n    }\n    await ((_orama_index_afterRemove = (_orama_index1 = orama.index).afterRemove) === null || _orama_index_afterRemove === void 0 ? void 0 : _orama_index_afterRemove.call(_orama_index1, orama.data.index, prop, id, value, schemaType, language, orama.tokenizer, docsCount));\n  }\n  const sortableProperties = await orama.sorter.getSortableProperties(orama.data.sorting);\n  const sortableValues = await orama.getDocumentProperties(doc, sortableProperties);\n  for (const prop of sortableProperties) {\n    // The document doens't contain the key\n    if (typeof sortableValues[prop] === 'undefined') {\n      continue;\n    }\n    await orama.sorter.remove(orama.data.sorting, prop, id);\n  }\n  if (!skipHooks) {\n    await runSingleHook(orama.afterRemove, orama, id);\n  }\n  await orama.documentsStore.remove(orama.data.docs, id);\n  trackRemoval(orama);\n  return result;\n}\nexport async function removeMultiple(orama, ids, batchSize, language, skipHooks) {\n  let result = 0;\n  if (!batchSize) {\n    batchSize = 1000;\n  }\n  if (!skipHooks) {\n    await runMultipleHook(orama.beforeMultipleRemove, orama, ids);\n  }\n  await new Promise((resolve, reject) => {\n    let i = 0;\n    async function _insertMultiple() {\n      const batch = ids.slice(i * batchSize, (i + 1) * batchSize);\n      i++;\n      if (!batch.length) {\n        return resolve();\n      }\n      for (const doc of batch) {\n        try {\n          if (await remove(orama, doc, language, skipHooks)) {\n            result++;\n          }\n        } catch (err) {\n          reject(err);\n        }\n      }\n      setTimeout(_insertMultiple, 0);\n    }\n    setTimeout(_insertMultiple, 0);\n  });\n  if (!skipHooks) {\n    await runMultipleHook(orama.afterMultipleRemove, orama, ids);\n  }\n  return result;\n}","map":{"version":3,"names":["runMultipleHook","runSingleHook","trackRemoval","remove","orama","id","language","skipHooks","result","index","docs","data","doc","documentsStore","get","docsCount","count","beforeRemove","indexableProperties","getSearchableProperties","indexablePropertiesWithTypes","getSearchablePropertiesWithTypes","values","getDocumentProperties","prop","_orama_index","_orama_index_beforeRemove","_orama_index1","_orama_index_afterRemove","value","schemaType","call","tokenizer","afterRemove","sortableProperties","sorter","getSortableProperties","sorting","sortableValues","removeMultiple","ids","batchSize","beforeMultipleRemove","Promise","resolve","reject","i","_insertMultiple","batch","slice","length","err","setTimeout","afterMultipleRemove"],"sources":["/home/krug/Coding/JavaScript/Websites/Personal/personal/node_modules/.pnpm/@orama+orama@1.0.3/node_modules/@orama/orama/src/methods/remove.ts"],"sourcesContent":["import { runMultipleHook, runSingleHook } from '../components/hooks.js'\nimport { trackRemoval } from '../components/sync-blocking-checker.js'\nimport { Orama } from '../types.js'\n\nexport async function remove(orama: Orama, id: string, language?: string, skipHooks?: boolean): Promise<boolean> {\n  let result = true\n  const { index, docs } = orama.data\n\n  const doc = await orama.documentsStore.get(docs, id)\n  if (!doc) {\n    return false\n  }\n\n  const docsCount = await orama.documentsStore.count(docs)\n\n  if (!skipHooks) {\n    await runSingleHook(orama.beforeRemove, orama, id)\n  }\n\n  const indexableProperties = await orama.index.getSearchableProperties(index)\n  const indexablePropertiesWithTypes = await orama.index.getSearchablePropertiesWithTypes(index)\n  const values = await orama.getDocumentProperties(doc, indexableProperties)\n\n  for (const prop of indexableProperties) {\n    const value = values[prop]\n    // The document doens't contain the key\n    if (typeof value === 'undefined') {\n      continue\n    }\n\n    const schemaType = indexablePropertiesWithTypes[prop]\n\n    await orama.index.beforeRemove?.(\n      orama.data.index,\n      prop,\n      id,\n      value,\n      schemaType,\n      language,\n      orama.tokenizer,\n      docsCount,\n    )\n    if (\n      !(await orama.index.remove(\n        orama.index,\n        orama.data.index,\n        prop,\n        id,\n        value,\n        schemaType,\n        language,\n        orama.tokenizer,\n        docsCount,\n      ))\n    ) {\n      result = false\n    }\n    await orama.index.afterRemove?.(orama.data.index, prop, id, value, schemaType, language, orama.tokenizer, docsCount)\n  }\n\n  const sortableProperties = await orama.sorter.getSortableProperties(orama.data.sorting)\n  const sortableValues = await orama.getDocumentProperties(doc, sortableProperties)\n  for (const prop of sortableProperties) {\n    // The document doens't contain the key\n    if (typeof sortableValues[prop] === 'undefined') {\n      continue\n    }\n\n    await orama.sorter.remove(orama.data.sorting, prop, id)\n  }\n\n  if (!skipHooks) {\n    await runSingleHook(orama.afterRemove, orama, id)\n  }\n\n  await orama.documentsStore.remove(orama.data.docs, id)\n\n  trackRemoval(orama)\n  return result\n}\n\nexport async function removeMultiple(\n  orama: Orama,\n  ids: string[],\n  batchSize?: number,\n  language?: string,\n  skipHooks?: boolean,\n): Promise<number> {\n  let result = 0\n\n  if (!batchSize) {\n    batchSize = 1000\n  }\n\n  if (!skipHooks) {\n    await runMultipleHook(orama.beforeMultipleRemove, orama, ids)\n  }\n\n  await new Promise<void>((resolve, reject) => {\n    let i = 0\n    async function _insertMultiple() {\n      const batch = ids.slice(i * batchSize!, (i + 1) * batchSize!)\n      i++\n\n      if (!batch.length) {\n        return resolve()\n      }\n\n      for (const doc of batch) {\n        try {\n          if (await remove(orama, doc, language, skipHooks)) {\n            result++\n          }\n        } catch (err) {\n          reject(err)\n        }\n      }\n\n      setTimeout(_insertMultiple, 0)\n    }\n\n    setTimeout(_insertMultiple, 0)\n  })\n\n  if (!skipHooks) {\n    await runMultipleHook(orama.afterMultipleRemove, orama, ids)\n  }\n\n  return result\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}