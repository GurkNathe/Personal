{"ast":null,"code":"import _toConsumableArray from \"/home/krug/Coding/JavaScript/Websites/Personal/personal/node_modules/.pnpm/@babel+runtime@7.22.3/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/home/krug/Coding/JavaScript/Websites/Personal/personal/node_modules/.pnpm/@babel+runtime@7.22.3/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport { createError } from '../errors.js';\nexport function prioritizeTokenScores(arrays, boost) {\n  var threshold = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  if (boost === 0) {\n    throw createError('INVALID_BOOST_VALUE');\n  }\n  var tokenMap = {};\n  var mapsLength = arrays.length;\n  for (var i = 0; i < mapsLength; i++) {\n    var arr = arrays[i];\n    var entriesLength = arr.length;\n    for (var j = 0; j < entriesLength; j++) {\n      var _arr$j = _slicedToArray(arr[j], 2),\n        token = _arr$j[0],\n        score = _arr$j[1];\n      var boostScore = score * boost;\n      if (token in tokenMap) {\n        tokenMap[token] *= 1.5 + boostScore;\n      } else {\n        tokenMap[token] = boostScore;\n      }\n    }\n  }\n  var results = Object.entries(tokenMap).sort(function (a, b) {\n    return b[1] - a[1];\n  });\n  // If threshold is 1, it means we will return all the results with at least one search term,\n  // prioritizig the ones that contains more search terms (fuzzy match)\n  if (threshold === 1) {\n    return results;\n  }\n  // If threshold is 0, it means we will only return all the results that contains ALL the search terms (exact match)\n  if (threshold === 0) {\n    var shortestArrayLength = Math.min.apply(Math, _toConsumableArray(arrays.map(function (arr) {\n      return arr.length;\n    })));\n    return results.slice(0, shortestArrayLength);\n  }\n  // If the theshold is between 0 and 1, we will return all the results that contains at least the threshold of search terms\n  // For example, if threshold is 0.5, we will return all the results that contains at least 50% of the search terms\n  // (fuzzy match with a minimum threshold)\n  var thresholdLength = Math.ceil(threshold * 100 * results.length / 100);\n  return results.slice(0, results.length + thresholdLength);\n}\nexport function BM25(tf, matchingCount, docsCount, fieldLength, averageFieldLength, BM25Params) {\n  var k = BM25Params.k,\n    b = BM25Params.b,\n    d = BM25Params.d;\n  var idf = Math.log(1 + (docsCount - matchingCount + 0.5) / (matchingCount + 0.5));\n  return idf * (d + tf * (k + 1)) / (tf + k * (1 - b + b * fieldLength / averageFieldLength));\n}","map":{"version":3,"names":["createError","prioritizeTokenScores","arrays","boost","threshold","arguments","length","undefined","tokenMap","mapsLength","i","arr","entriesLength","j","_arr$j","_slicedToArray","token","score","boostScore","results","Object","entries","sort","a","b","shortestArrayLength","Math","min","apply","_toConsumableArray","map","slice","thresholdLength","ceil","BM25","tf","matchingCount","docsCount","fieldLength","averageFieldLength","BM25Params","k","d","idf","log"],"sources":["/home/krug/Coding/JavaScript/Websites/Personal/personal/node_modules/.pnpm/@orama+orama@1.0.3/node_modules/@orama/orama/src/components/algorithms.ts"],"sourcesContent":["import { createError } from '../errors.js'\nimport { TokenScore, BM25Params } from '../types.js'\n\nexport function prioritizeTokenScores(arrays: TokenScore[][], boost: number, threshold = 1): TokenScore[] {\n  if (boost === 0) {\n    throw createError('INVALID_BOOST_VALUE')\n  }\n\n  const tokenMap: Record<string, number> = {}\n\n  const mapsLength = arrays.length\n  for (let i = 0; i < mapsLength; i++) {\n    const arr = arrays[i]\n\n    const entriesLength = arr.length\n    for (let j = 0; j < entriesLength; j++) {\n      const [token, score] = arr[j]\n      const boostScore = score * boost\n\n      if (token in tokenMap) {\n        tokenMap[token] *= 1.5 + boostScore\n      } else {\n        tokenMap[token] = boostScore\n      }\n    }\n  }\n\n  const results = Object.entries(tokenMap).sort((a, b) => b[1] - a[1])\n\n  // If threshold is 1, it means we will return all the results with at least one search term,\n  // prioritizig the ones that contains more search terms (fuzzy match)\n  if (threshold === 1) {\n    return results\n  }\n\n  // If threshold is 0, it means we will only return all the results that contains ALL the search terms (exact match)\n  if (threshold === 0) {\n    const shortestArrayLength = Math.min(...arrays.map(arr => arr.length))\n    return results.slice(0, shortestArrayLength)\n  }\n\n  // If the theshold is between 0 and 1, we will return all the results that contains at least the threshold of search terms\n  // For example, if threshold is 0.5, we will return all the results that contains at least 50% of the search terms\n  // (fuzzy match with a minimum threshold)\n  const thresholdLength = Math.ceil((threshold * 100 * results.length) / 100)\n\n  return results.slice(0, results.length + thresholdLength)\n}\n\nexport function BM25(\n  tf: number,\n  matchingCount: number,\n  docsCount: number,\n  fieldLength: number,\n  averageFieldLength: number,\n  BM25Params: Required<BM25Params>,\n) {\n  const { k, b, d } = BM25Params\n  const idf = Math.log(1 + (docsCount - matchingCount + 0.5) / (matchingCount + 0.5))\n  return (idf * (d + tf * (k + 1))) / (tf + k * (1 - b + (b * fieldLength) / averageFieldLength))\n}\n"],"mappings":";;AAAA,SAASA,WAAW,QAAQ;AAG5B,OAAO,SAASC,sBAAsBC,MAAsB,EAAEC,KAAa,EAA+B;EAAA,IAA7BC,SAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAY,CAAC;EACxF,IAAIF,KAAA,KAAU,GAAG;IACf,MAAMH,WAAA,CAAY;EACpB;EAEA,IAAMQ,QAAA,GAAmC,CAAC;EAE1C,IAAMC,UAAA,GAAaP,MAAA,CAAOI,MAAM;EAChC,KAAK,IAAII,CAAA,GAAI,GAAGA,CAAA,GAAID,UAAA,EAAYC,CAAA,IAAK;IACnC,IAAMC,GAAA,GAAMT,MAAM,CAACQ,CAAA,CAAE;IAErB,IAAME,aAAA,GAAgBD,GAAA,CAAIL,MAAM;IAChC,KAAK,IAAIO,CAAA,GAAI,GAAGA,CAAA,GAAID,aAAA,EAAeC,CAAA,IAAK;MACtC,IAAAC,MAAA,GAAAC,cAAA,CAAuBJ,GAAG,CAACE,CAAA,CAAE;QAAtBG,KAAA,GAAAF,MAAA;QAAOG,KAAA,GAAAH,MAAA;MACd,IAAMI,UAAA,GAAaD,KAAA,GAAQd,KAAA;MAE3B,IAAIa,KAAA,IAASR,QAAA,EAAU;QACrBA,QAAQ,CAACQ,KAAA,CAAM,IAAI,MAAME,UAAA;MAC3B,OAAO;QACLV,QAAQ,CAACQ,KAAA,CAAM,GAAGE,UAAA;MACpB;IACF;EACF;EAEA,IAAMC,OAAA,GAAUC,MAAA,CAAOC,OAAO,CAACb,QAAA,EAAUc,IAAI,CAAC,UAACC,CAAA,EAAGC,CAAA;IAAA,OAAMA,CAAC,CAAC,EAAE,GAAGD,CAAC,CAAC,EAAE;EAAA;EAEnE;EACA;EACA,IAAInB,SAAA,KAAc,GAAG;IACnB,OAAOe,OAAA;EACT;EAEA;EACA,IAAIf,SAAA,KAAc,GAAG;IACnB,IAAMqB,mBAAA,GAAsBC,IAAA,CAAKC,GAAG,CAAAC,KAAA,CAARF,IAAA,EAAAG,kBAAA,CAAY3B,MAAA,CAAO4B,GAAG,CAAC,UAAAnB,GAAA;MAAA,OAAOA,GAAA,CAAIL,MAAM;IAAA;IACpE,OAAOa,OAAA,CAAQY,KAAK,CAAC,GAAGN,mBAAA;EAC1B;EAEA;EACA;EACA;EACA,IAAMO,eAAA,GAAkBN,IAAA,CAAKO,IAAI,CAAC7B,SAAC,GAAY,MAAMe,OAAA,CAAQb,MAAM,GAAI;EAEvE,OAAOa,OAAA,CAAQY,KAAK,CAAC,GAAGZ,OAAA,CAAQb,MAAM,GAAG0B,eAAA;AAC3C;AAEA,OAAO,SAASE,KACdC,EAAU,EACVC,aAAqB,EACrBC,SAAiB,EACjBC,WAAmB,EACnBC,kBAA0B,EAC1BC,UAAgC,EAChC;EACA,IAAQC,CAAA,GAAYD,UAAA,CAAZC,CAAA;IAAGjB,CAAA,GAASgB,UAAA,CAAThB,CAAA;IAAGkB,CAAA,GAAMF,UAAA,CAANE,CAAA;EACd,IAAMC,GAAA,GAAMjB,IAAA,CAAKkB,GAAG,CAAC,IAAI,CAACP,SAAA,GAAYD,aAAA,GAAgB,GAAE,KAAMA,aAAA,GAAgB,GAAE;EAChF,OAAOO,GAAC,IAAOD,CAAA,GAAIP,EAAA,IAAMM,CAAA,GAAI,EAAC,KAAON,EAAA,GAAKM,CAAA,IAAK,IAAIjB,CAAA,GAAIA,CAAC,GAAIc,WAAA,GAAeC,kBAAiB,CAAC;AAC/F"},"metadata":{},"sourceType":"module","externalDependencies":[]}