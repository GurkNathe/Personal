{"version":3,"sources":["../../src/components/cosine-similarity.ts"],"sourcesContent":["import type { Magnitude, VectorType } from '../types.js'\n\nexport type SimilarVector = {\n  id: string\n  score: number\n}\n\nexport function getMagnitude(vector: Float32Array, vectorLength: number): number {\n  let magnitude = 0\n  for (let i = 0; i < vectorLength; i++) {\n    magnitude += vector[i] * vector[i]\n  }\n  return Math.sqrt(magnitude)\n}\n\n// @todo: Write plugins for Node and Browsers to use parallel computation for this function\nexport function findSimilarVectors(\n  targetVector: Float32Array,\n  vectors: Record<string, [Magnitude, VectorType]>,\n  length: number,\n  threshold = 0.8\n) {\n  const targetMagnitude = getMagnitude(targetVector, length);\n\n  const similarVectors: SimilarVector[] = []\n\n  for (const [vectorId, [magnitude, vector]] of Object.entries(vectors)) {\n    let dotProduct = 0\n\n    for (let i = 0; i < length; i++) {\n      dotProduct += targetVector[i] * vector[i]\n    }\n\n    const similarity = dotProduct / (targetMagnitude * magnitude)\n\n    if (similarity >= threshold) {\n      similarVectors.push({ id: vectorId, score: similarity })\n    }\n  }\n\n  return similarVectors.sort((a, b) => b.score - a.score)\n}\n\n"],"names":["getMagnitude","vector","vectorLength","magnitude","i","Math","sqrt","findSimilarVectors","targetVector","vectors","length","threshold","targetMagnitude","similarVectors","vectorId","Object","entries","dotProduct","similarity","push","id","score","sort","a","b"],"mappings":"AAOA,OAAO,SAASA,aAAaC,MAAoB,EAAEC,YAAoB,EAAU;IAC/E,IAAIC,YAAY;IAChB,IAAK,IAAIC,IAAI,GAAGA,IAAIF,cAAcE,IAAK;QACrCD,aAAaF,MAAM,CAACG,EAAE,GAAGH,MAAM,CAACG,EAAE;IACpC;IACA,OAAOC,KAAKC,IAAI,CAACH;AACnB,CAAC;AAED,2FAA2F;AAC3F,OAAO,SAASI,mBACdC,YAA0B,EAC1BC,OAAgD,EAChDC,MAAc,EACdC,YAAY,GAAG,EACf;IACA,MAAMC,kBAAkBZ,aAAaQ,cAAcE;IAEnD,MAAMG,iBAAkC,EAAE;IAE1C,KAAK,MAAM,CAACC,UAAU,CAACX,WAAWF,OAAO,CAAC,IAAIc,OAAOC,OAAO,CAACP,SAAU;QACrE,IAAIQ,aAAa;QAEjB,IAAK,IAAIb,IAAI,GAAGA,IAAIM,QAAQN,IAAK;YAC/Ba,cAAcT,YAAY,CAACJ,EAAE,GAAGH,MAAM,CAACG,EAAE;QAC3C;QAEA,MAAMc,aAAaD,aAAcL,CAAAA,kBAAkBT,SAAQ;QAE3D,IAAIe,cAAcP,WAAW;YAC3BE,eAAeM,IAAI,CAAC;gBAAEC,IAAIN;gBAAUO,OAAOH;YAAW;QACxD,CAAC;IACH;IAEA,OAAOL,eAAeS,IAAI,CAAC,CAACC,GAAGC,IAAMA,EAAEH,KAAK,GAAGE,EAAEF,KAAK;AACxD,CAAC"}