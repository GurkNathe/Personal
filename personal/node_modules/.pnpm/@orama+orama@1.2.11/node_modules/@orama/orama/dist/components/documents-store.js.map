{"version":3,"sources":["../../src/components/documents-store.ts"],"sourcesContent":["import { AnyDocument, AnyDocumentStore, AnyOrama, IDocumentsStore, TypedDocument } from '../types.js'\nimport {\n  DocumentID,\n  InternalDocumentID,\n  InternalDocumentIDStore,\n  getInternalDocumentId,\n} from './internal-document-id-store.js'\n\nexport interface DocumentsStore extends AnyDocumentStore {\n  sharedInternalDocumentStore: InternalDocumentIDStore\n  docs: Record<InternalDocumentID, AnyDocument>\n  count: number\n}\n\nexport async function create<T extends AnyOrama>(\n  _: T,\n  sharedInternalDocumentStore: InternalDocumentIDStore,\n): Promise<DocumentsStore> {\n  return {\n    sharedInternalDocumentStore,\n    docs: {},\n    count: 0,\n  }\n}\n\nexport async function get<T extends AnyOrama, ResultDocument extends TypedDocument<T>>(\n  store: DocumentsStore,\n  id: DocumentID,\n): Promise<ResultDocument | undefined> {\n  const internalId = getInternalDocumentId(store.sharedInternalDocumentStore, id)\n\n  return store.docs[internalId]\n}\n\nexport async function getMultiple<T extends AnyOrama, ResultDocument extends TypedDocument<T>>(\n  store: DocumentsStore,\n  ids: DocumentID[],\n): Promise<(ResultDocument | undefined)[]> {\n  const found: (ResultDocument | undefined)[] = Array.from({ length: ids.length })\n\n  for (let i = 0; i < ids.length; i++) {\n    const internalId = getInternalDocumentId(store.sharedInternalDocumentStore, ids[i])\n    found[i] = store.docs[internalId]\n  }\n\n  return found\n}\n\nexport async function getAll<T extends AnyOrama, ResultDocument extends TypedDocument<T>>(\n  store: DocumentsStore,\n): Promise<Record<InternalDocumentID, ResultDocument>> {\n  return store.docs\n}\n\nexport async function store(\n  store: DocumentsStore,\n  id: DocumentID,\n  doc: AnyDocument,\n): Promise<boolean> {\n  const internalId = getInternalDocumentId(store.sharedInternalDocumentStore, id)\n\n  if (typeof store.docs[internalId] !== 'undefined') {\n    return false\n  }\n\n  store.docs[internalId] = doc\n  store.count++\n\n  return true\n}\n\nexport async function remove(\n  store: DocumentsStore,\n  id: DocumentID,\n): Promise<boolean> {\n  const internalId = getInternalDocumentId(store.sharedInternalDocumentStore, id)\n\n  if (typeof store.docs[internalId] === 'undefined') {\n    return false\n  }\n\n  delete store.docs[internalId]\n  store.count--\n\n  return true\n}\n\nexport async function count(\n  store: DocumentsStore,\n): Promise<number> {\n  return store.count\n}\n\nexport async function load<R = unknown>(\n  sharedInternalDocumentStore: InternalDocumentIDStore,\n  raw: R,\n): Promise<DocumentsStore> {\n  const rawDocument = raw as DocumentsStore\n\n  return {\n    docs: rawDocument.docs,\n    count: rawDocument.count,\n    sharedInternalDocumentStore,\n  }\n}\n\nexport async function save<R = unknown>(store: DocumentsStore): Promise<R> {\n  return {\n    docs: store.docs,\n    count: store.count,\n  } as R\n}\n\nexport async function createDocumentsStore(): Promise<IDocumentsStore<DocumentsStore>> {\n  return {\n    create,\n    get,\n    getMultiple,\n    getAll,\n    store,\n    remove,\n    count,\n    load,\n    save,\n  }\n}\n"],"names":["getInternalDocumentId","create","_","sharedInternalDocumentStore","docs","count","get","store","id","internalId","getMultiple","ids","found","Array","from","length","i","getAll","doc","remove","load","raw","rawDocument","save","createDocumentsStore"],"mappings":"AACA,SAIEA,qBAAqB,QAChB,kCAAiC;AAQxC,OAAO,eAAeC,OACpBC,CAAI,EACJC,2BAAoD,EAC3B;IACzB,OAAO;QACLA;QACAC,MAAM,CAAC;QACPC,OAAO;IACT;AACF,CAAC;AAED,OAAO,eAAeC,IACpBC,KAAqB,EACrBC,EAAc,EACuB;IACrC,MAAMC,aAAaT,sBAAsBO,MAAMJ,2BAA2B,EAAEK;IAE5E,OAAOD,MAAMH,IAAI,CAACK,WAAW;AAC/B,CAAC;AAED,OAAO,eAAeC,YACpBH,KAAqB,EACrBI,GAAiB,EACwB;IACzC,MAAMC,QAAwCC,MAAMC,IAAI,CAAC;QAAEC,QAAQJ,IAAII,MAAM;IAAC;IAE9E,IAAK,IAAIC,IAAI,GAAGA,IAAIL,IAAII,MAAM,EAAEC,IAAK;QACnC,MAAMP,aAAaT,sBAAsBO,MAAMJ,2BAA2B,EAAEQ,GAAG,CAACK,EAAE;QAClFJ,KAAK,CAACI,EAAE,GAAGT,MAAMH,IAAI,CAACK,WAAW;IACnC;IAEA,OAAOG;AACT,CAAC;AAED,OAAO,eAAeK,OACpBV,KAAqB,EACgC;IACrD,OAAOA,MAAMH,IAAI;AACnB,CAAC;AAED,OAAO,eAAeG,MACpBA,KAAqB,EACrBC,EAAc,EACdU,GAAgB,EACE;IAClB,MAAMT,aAAaT,sBAAsBO,MAAMJ,2BAA2B,EAAEK;IAE5E,IAAI,OAAOD,MAAMH,IAAI,CAACK,WAAW,KAAK,aAAa;QACjD,OAAO,KAAK;IACd,CAAC;IAEDF,MAAMH,IAAI,CAACK,WAAW,GAAGS;IACzBX,MAAMF,KAAK;IAEX,OAAO,IAAI;AACb,CAAC;AAED,OAAO,eAAec,OACpBZ,KAAqB,EACrBC,EAAc,EACI;IAClB,MAAMC,aAAaT,sBAAsBO,MAAMJ,2BAA2B,EAAEK;IAE5E,IAAI,OAAOD,MAAMH,IAAI,CAACK,WAAW,KAAK,aAAa;QACjD,OAAO,KAAK;IACd,CAAC;IAED,OAAOF,MAAMH,IAAI,CAACK,WAAW;IAC7BF,MAAMF,KAAK;IAEX,OAAO,IAAI;AACb,CAAC;AAED,OAAO,eAAeA,MACpBE,KAAqB,EACJ;IACjB,OAAOA,MAAMF,KAAK;AACpB,CAAC;AAED,OAAO,eAAee,KACpBjB,2BAAoD,EACpDkB,GAAM,EACmB;IACzB,MAAMC,cAAcD;IAEpB,OAAO;QACLjB,MAAMkB,YAAYlB,IAAI;QACtBC,OAAOiB,YAAYjB,KAAK;QACxBF;IACF;AACF,CAAC;AAED,OAAO,eAAeoB,KAAkBhB,KAAqB,EAAc;IACzE,OAAO;QACLH,MAAMG,MAAMH,IAAI;QAChBC,OAAOE,MAAMF,KAAK;IACpB;AACF,CAAC;AAED,OAAO,eAAemB,uBAAiE;IACrF,OAAO;QACLvB;QACAK;QACAI;QACAO;QACAV;QACAY;QACAd;QACAe;QACAG;IACF;AACF,CAAC"}